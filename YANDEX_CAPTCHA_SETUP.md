# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å SmartCaptcha

## ‚úÖ –ö–∞–ø—á–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

### –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:
- üìù –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- üß™ –ú–æ–¥–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Ç–µ—Å—Ç–∞  
- üìß –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞

### –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `<x-yandex-captcha />` - Blade –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ `YandexCaptcha` –ø—Ä–∞–≤–∏–ª–æ
- JavaScript –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ö

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞

### 1. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–º–µ–Ω –≤ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [–∫–æ–Ω—Å–æ–ª—å –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ](https://console.cloud.yandex.ru/)
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å **SmartCaptcha** ‚Üí –≤–∞—à–∞ –∫–∞–ø—á–∞
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω —Å–∞–π—Ç–∞ –≤ **"–°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤"**

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –≤ .env

```env
# –Ø–Ω–¥–µ–∫—Å SmartCaptcha
YANDEX_CAPTCHA_CLIENT_KEY=ysc1_...–≤–∞—à_client_key
YANDEX_CAPTCHA_SERVER_KEY=ysc2_...–≤–∞—à_server_key
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
php artisan config:clear

# –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–≤—Å–µ –∫–∞–Ω–∞–ª—ã)
php artisan test:notifications "–¢–µ—Å—Ç –∫–∞–ø—á–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ"
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ö

### Blade –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

–ö–∞–ø—á–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ñ–æ—Ä–º—ã:
- –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ (`recording-block.blade.php`)
- –ú–æ–¥–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Ç–µ—Å—Ç–∞ (`modal-test.blade.php`)

```blade
{{-- –î–æ–±–∞–≤–∏—Ç—å –≤ –ª—é–±—É—é —Ñ–æ—Ä–º—É --}}
<x-yandex-captcha />

{{-- –ò–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ --}}
<x-yandex-captcha theme="dark" size="compact" />
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ö–∞–ø—á–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤:
- `ContactController::sendContactForm()` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞
- `TestController::submitTest()` - —Ñ–æ—Ä–º–∞ —Ç–µ—Å—Ç–∞

```php
// –î–ª—è –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
'smart-token' => ['required', new \App\Rules\YandexCaptcha()],
```

### JavaScript –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–¢–æ–∫–µ–Ω –∫–∞–ø—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º—ã:
- `resources/js/recording-form.js` - —Ñ–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏
- `resources/js/yoga-test.js` - –º–æ–¥–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç

```javascript
// –î–ª—è –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º –¥–æ–±–∞–≤—å—Ç–µ –≤ FormData:
"smart-token": formData.get("smart-token")
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
php artisan test:yandex-captcha
```

### 2. –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–æ–∫–µ–Ω–æ–º
```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ñ–æ—Ä–º–æ–π
# 2. –ü—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É
# 3. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
#    document.querySelector('input[name="smart-token"]').value
# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º:
php artisan test:yandex-captcha –ø–æ–ª—É—á–µ–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Laravel –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
tail -f storage/logs/laravel.log | grep -i captcha
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ø—á–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- `theme` - —Ç–µ–º–∞ –∫–∞–ø—á–∏: `light` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), `dark`
- `size` - —Ä–∞–∑–º–µ—Ä: `normal` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), `compact`
- `class` - CSS –∫–ª–∞—Å—Å—ã
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ services.php
```php
'yandex_captcha' => [
    'client_key' => env('YANDEX_CAPTCHA_CLIENT_KEY'),
    'server_key' => env('YANDEX_CAPTCHA_SERVER_KEY'),
    'verify_url' => 'https://smartcaptcha.yandexcloud.net/validate',
],
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–∞–ø—á–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `YANDEX_CAPTCHA_CLIENT_KEY` –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ø—á–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ø–Ω–¥–µ–∫—Å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `YANDEX_CAPTCHA_SERVER_KEY` –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ `smart-token`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Laravel –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ API

### –ö–∞–ø—á–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∫–∞–ø—á–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (@once –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –¢–æ–∫–µ–Ω—ã –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∏ –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Laravel: `storage/logs/laravel.log`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `php artisan test:yandex-captcha`
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å SmartCaptcha